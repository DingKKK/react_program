{"ast":null,"code":"// src/FileEditorWithBugTable.js\nimport React,{useRef,useState,useEffect}from'react';import{Button,Table,message}from'antd';import Editor from'@monaco-editor/react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const FileEditorWithBugTable=_ref=>{let{selectedFile,onSaveFile,onBugDetection,tableData,setTableData}=_ref;const editorRef=useRef(null);const[tableHeight,setTableHeight]=useState(200);const[isResizing,setIsResizing]=useState(false);const[sortedInfo,setSortedInfo]=useState({});const handleChange=(pagination,filters,sorter)=>{setSortedInfo(sorter);};const handleEditorDidMount=(editor,monaco)=>{editorRef.current=editor;};const handleCellClick=location=>{const[lineNumber,colNumber]=location.match(/\\d+/g).map(Number);if(editorRef.current){editorRef.current.revealLineInCenter(lineNumber);editorRef.current.setPosition({lineNumber,column:colNumber});editorRef.current.focus();}};const handleDelete=key=>{const newData=tableData.filter(item=>item.key!==key);setTableData(newData);};const startResizing=e=>{setIsResizing(true);document.body.style.cursor='ns-resize';};const stopResizing=()=>{setIsResizing(false);document.body.style.cursor='default';};const resizeTable=e=>{if(isResizing){const newHeight=window.innerHeight-e.clientY;setTableHeight(newHeight);}};React.useEffect(()=>{window.addEventListener('mousemove',resizeTable);window.addEventListener('mouseup',stopResizing);return()=>{window.removeEventListener('mousemove',resizeTable);window.removeEventListener('mouseup',stopResizing);};},[isResizing]);const columns=[{title:'Id',dataIndex:'id',key:'id'},{title:'Severity',dataIndex:'severity',key:'severity',sorter:(a,b)=>a.severity.localeCompare(b.severity),sortOrder:sortedInfo.columnKey==='severity'&&sortedInfo.order},{title:'Type',dataIndex:'type',key:'type'},{title:'Qualifier',dataIndex:'qualifier',key:'qualifier'},{title:'Location',dataIndex:'location',key:'location',onCell:record=>({onClick:()=>handleCellClick(record.location)})},{title:'Confirm',key:'confirm',render:(text,record)=>/*#__PURE__*/_jsx(Button,{type:\"link\",onClick:()=>handleDelete(record.key),children:\"Delete\"})}];const handleBugDetectionClick=()=>{if(editorRef.current){const editorValue=editorRef.current.getValue();onBugDetection(editorValue);}else{message.error('Editor is not ready');}};return/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',height:'100vh'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',marginBottom:'10px'},children:[/*#__PURE__*/_jsx(\"p\",{style:{marginRight:'10px'},children:selectedFile.title}),/*#__PURE__*/_jsx(Button,{onClick:handleBugDetectionClick,children:\"\\u6F0F\\u6D1E\\u68C0\\u6D4B\"}),/*#__PURE__*/_jsx(Button,{children:\"\\u8865\\u4E01\\u4FEE\\u590D\"})]}),/*#__PURE__*/_jsx(Editor,{height:\"calc(100vh - \".concat(tableHeight+50,\"px)\"),defaultLanguage:\"cpp\",value:selectedFile.content,onMount:handleEditorDidMount}),/*#__PURE__*/_jsxs(\"div\",{style:{height:\"\".concat(tableHeight,\"px\"),overflow:'auto',marginTop:'20px',position:'relative'},children:[/*#__PURE__*/_jsx(Table,{columns:columns,dataSource:tableData,onChange:handleChange,pagination:false}),/*#__PURE__*/_jsx(\"div\",{style:{height:'5px',backgroundColor:'gray',cursor:'ns-resize',position:'absolute',top:0,width:'100%'},onMouseDown:startResizing})]})]});};export default FileEditorWithBugTable;","map":{"version":3,"names":["React","useRef","useState","useEffect","Button","Table","message","Editor","jsx","_jsx","jsxs","_jsxs","FileEditorWithBugTable","_ref","selectedFile","onSaveFile","onBugDetection","tableData","setTableData","editorRef","tableHeight","setTableHeight","isResizing","setIsResizing","sortedInfo","setSortedInfo","handleChange","pagination","filters","sorter","handleEditorDidMount","editor","monaco","current","handleCellClick","location","lineNumber","colNumber","match","map","Number","revealLineInCenter","setPosition","column","focus","handleDelete","key","newData","filter","item","startResizing","e","document","body","style","cursor","stopResizing","resizeTable","newHeight","window","innerHeight","clientY","addEventListener","removeEventListener","columns","title","dataIndex","a","b","severity","localeCompare","sortOrder","columnKey","order","onCell","record","onClick","render","text","type","children","handleBugDetectionClick","editorValue","getValue","error","display","flexDirection","height","alignItems","marginBottom","marginRight","concat","defaultLanguage","value","content","onMount","overflow","marginTop","position","dataSource","onChange","backgroundColor","top","width","onMouseDown"],"sources":["/home/njucs/bugDetection&Repair/code/src/FileEditorWithBugTable.js"],"sourcesContent":["// src/FileEditorWithBugTable.js\nimport React, { useRef, useState, useEffect } from 'react';\nimport { Button, Table, message } from 'antd';\nimport Editor from '@monaco-editor/react';\n\nconst FileEditorWithBugTable = ({ selectedFile, onSaveFile, onBugDetection ,tableData, setTableData }) => {\n  const editorRef = useRef(null);\n  const [tableHeight, setTableHeight] = useState(200);\n  const [isResizing, setIsResizing] = useState(false);\n  const [sortedInfo, setSortedInfo] = useState({});\n\n  const handleChange = (pagination, filters, sorter) => {\n    setSortedInfo(sorter);\n  };\n  const handleEditorDidMount = (editor, monaco) => {\n    editorRef.current = editor;\n  };\n\n  const handleCellClick = (location) => {\n    const [lineNumber, colNumber] = location.match(/\\d+/g).map(Number);\n    if (editorRef.current) {\n      editorRef.current.revealLineInCenter(lineNumber);\n      editorRef.current.setPosition({ lineNumber, column: colNumber });\n      editorRef.current.focus();\n    }\n  };\n\n  const handleDelete = (key) => {\n    const newData = tableData.filter((item) => item.key !== key);\n    setTableData(newData);\n  };\n\n  const startResizing = (e) => {\n    setIsResizing(true);\n    document.body.style.cursor = 'ns-resize';\n  };\n\n  const stopResizing = () => {\n    setIsResizing(false);\n    document.body.style.cursor = 'default';\n  };\n\n  const resizeTable = (e) => {\n    if (isResizing) {\n      const newHeight = window.innerHeight - e.clientY;\n      setTableHeight(newHeight);\n    }\n  };\n\n  React.useEffect(() => {\n    window.addEventListener('mousemove', resizeTable);\n    window.addEventListener('mouseup', stopResizing);\n    return () => {\n      window.removeEventListener('mousemove', resizeTable);\n      window.removeEventListener('mouseup', stopResizing);\n    };\n  }, [isResizing]);\n\n  const columns = [\n    {\n      title: 'Id',\n      dataIndex: 'id',\n      key: 'id',\n    },\n    {\n      title: 'Severity',\n      dataIndex: 'severity',\n      key: 'severity',\n      sorter: (a, b) => a.severity.localeCompare(b.severity),\n      sortOrder: sortedInfo.columnKey === 'severity' && sortedInfo.order\n    },\n    {\n      title: 'Type',\n      dataIndex: 'type',\n      key: 'type',\n    },\n    {\n      title: 'Qualifier',\n      dataIndex: 'qualifier',\n      key: 'qualifier',\n    },\n    {\n      title: 'Location',\n      dataIndex: 'location',\n      key: 'location',\n      onCell: (record) => ({\n        onClick: () => handleCellClick(record.location),\n      }),\n    },\n    {\n      title: 'Confirm',\n      key: 'confirm',\n      render: (text, record) => (\n        <Button type=\"link\" onClick={() => handleDelete(record.key)}>\n          Delete\n        </Button>\n      ),\n    },\n  ];\n  const handleBugDetectionClick = () => {\n    if (editorRef.current) {\n      const editorValue = editorRef.current.getValue();\n      onBugDetection(editorValue);\n    } else {\n      message.error('Editor is not ready');\n    }\n  };\n  return (\n    <div style={{ display: 'flex', flexDirection: 'column', height: '100vh' }}>\n      <div style={{ display: 'flex', alignItems: 'center', marginBottom: '10px' }}>\n        <p style={{ marginRight: '10px' }}>{selectedFile.title}</p>\n        <Button onClick={handleBugDetectionClick}>漏洞检测</Button>\n        <Button>补丁修复</Button>\n      </div>\n      <Editor\n        height={`calc(100vh - ${tableHeight + 50}px)`}\n        defaultLanguage=\"cpp\"\n        value={selectedFile.content}\n        onMount={handleEditorDidMount}\n      />\n      <div style={{ height: `${tableHeight}px`, overflow: 'auto', marginTop: '20px', position: 'relative' }}>\n        <Table columns={columns} dataSource={tableData} onChange={handleChange} pagination={false} />\n        <div\n          style={{\n            height: '5px',\n            backgroundColor: 'gray',\n            cursor: 'ns-resize',\n            position: 'absolute',\n            top: 0,\n            width: '100%',\n          }}\n          onMouseDown={startResizing}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default FileEditorWithBugTable;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}