{"ast":null,"code":"// src/App.js\nimport React,{useState,useRef,useEffect}from'react';import{Layout,message}from'antd';import FileUploader from'./FileUploader';import FileTree from'./FileTree';import FileEditorWithBugTable from'./FileEditorWithBugTable';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const{Sider,Content}=Layout;const App=()=>{const[selectedFile,setSelectedFile]=useState(null);const[fileData,setFileData]=useState([]);const[messages,setMessages]=useState([]);const[tableData,setTableData]=useState([]);const socket=useRef(null);useEffect(()=>{socket.current=new WebSocket('ws://localhost:3000');socket.current.onopen=()=>setMessages(prev=>[...prev,'Connected to server']);socket.current.onmessage=event=>{try{let data=JSON.parse(event.data);console.log(data);if(data.type==='bugData'){data=JSON.parse(data.content);let index=0;const newDataList=data.map(item=>{// 选取每个元素中的部分内容\nindex+=1;return{key:index,id:index,severity:item.severity,type:item.bug_type,qualifier:item.qualifier,location:'ln '+item.line+', cl '+item.column// 你可以根据需要选取更多的字段或属性\n};});setTableData(newDataList);}setMessages(prev=>[...prev,data.message]);}catch(error){console.error('Error parsing message',error);setMessages(prev=>[...prev,'Error parsing message']);}};socket.current.onclose=()=>setMessages(prev=>[...prev,'Disconnected from server']);socket.current.onerror=error=>setMessages(prev=>[...prev,\"WebSocket error: \".concat(error.message)]);return()=>{if(socket.current){socket.current.close();}};},[]);const handleFileSelect=file=>{if(file&&file.type==='file'){setSelectedFile(file);}};const handleSaveFile=newContent=>{if(selectedFile){const updatedFile={...selectedFile,content:newContent};setSelectedFile(updatedFile);if(socket.current&&socket.current.readyState===WebSocket.OPEN){const messageContent=JSON.stringify({path:updatedFile.path,content:updatedFile.content});socket.current.send(messageContent);message.success('File saved successfully');}}};const bugDetection=newContent=>{console.log('sent');if(selectedFile){const updatedFile={...selectedFile,content:newContent};setSelectedFile(updatedFile);console.log(updatedFile.content);if(socket.current&&socket.current.readyState===WebSocket.OPEN){const messageContent=JSON.stringify({type:'bugDetection',content:updatedFile.content});socket.current.send(messageContent);message.success('File sent');}}};const patchGeneration=newContent=>{if(selectedFile){if(socket.current&&socket.current.readyState===WebSocket.OPEN){const messageContent=JSON.stringify({type:'patchGeneration'});socket.current.send(messageContent);message.success('File sent');}}};return/*#__PURE__*/_jsxs(Layout,{style:{minHeight:'100vh'},children:[/*#__PURE__*/_jsxs(Sider,{theme:\"light\",children:[/*#__PURE__*/_jsx(FileUploader,{onFileUpload:setFileData}),/*#__PURE__*/_jsx(FileTree,{fileData:fileData,onSelectFile:handleFileSelect})]}),/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsx(Content,{children:selectedFile?/*#__PURE__*/_jsx(FileEditorWithBugTable,{selectedFile:selectedFile,setSelectedFile:setSelectedFile,onBugDetection:bugDetection,tableData:tableData,onPatchGeneration:patchGeneration}):/*#__PURE__*/_jsx(\"div\",{style:{padding:'20px'},children:\"\\u9009\\u62E9\\u4E00\\u4E2A\\u6587\\u4EF6\\u4EE5\\u5F00\\u59CB\\u7F16\\u8F91\"})})})]});};export default App;","map":{"version":3,"names":["React","useState","useRef","useEffect","Layout","message","FileUploader","FileTree","FileEditorWithBugTable","jsx","_jsx","jsxs","_jsxs","Sider","Content","App","selectedFile","setSelectedFile","fileData","setFileData","messages","setMessages","tableData","setTableData","socket","current","WebSocket","onopen","prev","onmessage","event","data","JSON","parse","console","log","type","content","index","newDataList","map","item","key","id","severity","bug_type","qualifier","location","line","column","error","onclose","onerror","concat","close","handleFileSelect","file","handleSaveFile","newContent","updatedFile","readyState","OPEN","messageContent","stringify","path","send","success","bugDetection","patchGeneration","style","minHeight","children","theme","onFileUpload","onSelectFile","onBugDetection","onPatchGeneration","padding"],"sources":["/home/njucs/bugDetection&Repair/code/src/App.js"],"sourcesContent":["// src/App.js\nimport React, { useState, useRef, useEffect } from 'react';\nimport { Layout , message } from 'antd';\nimport FileUploader from './FileUploader';\nimport FileTree from './FileTree';\nimport FileEditorWithBugTable from './FileEditorWithBugTable';\nconst { Sider, Content } = Layout;\n\nconst App = () => {\n  const [selectedFile, setSelectedFile] = useState(null);\n  const [fileData, setFileData] = useState([]);\n  const [messages, setMessages] = useState([]);\n  const [tableData, setTableData] = useState([]);\n  const socket = useRef(null);\n\n  useEffect(() => {\n    socket.current = new WebSocket('ws://localhost:3000');\n    socket.current.onopen = () => setMessages((prev) => [...prev, 'Connected to server']);\n    socket.current.onmessage = (event) => {\n      try {\n        let data = JSON.parse(event.data);\n        console.log(data);\n        if(data.type === 'bugData'){\n          data = JSON.parse(data.content);\n          let index = 0;\n          const newDataList = data.map(item => {\n            // 选取每个元素中的部分内容\n            index += 1;\n            return {\n              key: index,\n              id: index,\n              severity: item.severity,\n              type: item.bug_type,\n              qualifier: item.qualifier,\n              location: 'ln '+item.line+', cl '+item.column\n              // 你可以根据需要选取更多的字段或属性\n            };\n          });\n          setTableData(newDataList);\n        }\n        setMessages((prev) => [...prev, data.message]);\n      } catch (error) {\n        console.error('Error parsing message', error);\n        setMessages((prev) => [...prev, 'Error parsing message']);\n      }\n    };\n    socket.current.onclose = () => setMessages((prev) => [...prev, 'Disconnected from server']);\n    socket.current.onerror = (error) => setMessages((prev) => [...prev, `WebSocket error: ${error.message}`]);\n\n    return () => {\n      if (socket.current) {\n        socket.current.close();\n      }\n    };\n  }, []);\n\n  const handleFileSelect = (file) => {\n    if (file && file.type === 'file') {\n      setSelectedFile(file);\n    }\n  };\n\n  const handleSaveFile = (newContent) => {\n    if (selectedFile) {\n      const updatedFile = { ...selectedFile, content: newContent };\n      setSelectedFile(updatedFile);\n      if (socket.current && socket.current.readyState === WebSocket.OPEN) {\n        const messageContent = JSON.stringify({\n          path: updatedFile.path,\n          content: updatedFile.content,\n        });\n        socket.current.send(messageContent);\n        message.success('File saved successfully');\n      }\n    }\n  };\n\n  const bugDetection = (newContent) => {\n    console.log('sent');\n    if (selectedFile) {\n        const updatedFile = { ...selectedFile, content: newContent };\n        setSelectedFile(updatedFile);\n        console.log(updatedFile.content)\n        if (socket.current && socket.current.readyState === WebSocket.OPEN) {\n          const messageContent = JSON.stringify({\n            type: 'bugDetection',\n            content: updatedFile.content,\n          });\n          socket.current.send(messageContent);\n          message.success('File sent');\n        }\n    }\n  };\n\n  const patchGeneration = (newContent) => {\n    if (selectedFile) {\n      if (socket.current && socket.current.readyState === WebSocket.OPEN) {\n        const messageContent = JSON.stringify({\n          type: 'patchGeneration',\n        });\n        socket.current.send(messageContent);\n        message.success('File sent');\n      }\n    }\n  };\n  return (\n    <Layout style={{ minHeight: '100vh' }}>\n      <Sider theme=\"light\">\n        <FileUploader onFileUpload={setFileData}/>\n        <FileTree fileData={fileData} onSelectFile={handleFileSelect} />\n      </Sider>\n      <Layout>\n        <Content>\n          {selectedFile ? (\n            <FileEditorWithBugTable\n              selectedFile={selectedFile}\n              setSelectedFile={setSelectedFile}\n              onBugDetection={bugDetection}\n              tableData={tableData}\n              onPatchGeneration={patchGeneration}\n            />\n          ) : (\n            <div style={{ padding: '20px' }}>选择一个文件以开始编辑</div>\n          )}\n        </Content>\n      </Layout>\n    </Layout>\n  );\n};\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}