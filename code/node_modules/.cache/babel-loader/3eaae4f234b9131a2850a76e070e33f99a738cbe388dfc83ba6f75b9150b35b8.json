{"ast":null,"code":"// src/App.js\nimport React,{useState,useRef,useEffect}from'react';import{Layout,message}from'antd';import FileUploader from'./FileUploader';import FileTree from'./FileTree';import FileEditorWithBugTable from'./FileEditorWithBugTable';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const{Sider,Content}=Layout;const App=()=>{const[selectedFile,setSelectedFile]=useState(null);const[fileData,setFileData]=useState([]);const[messages,setMessages]=useState([]);const[tableData,setTableData]=useState([]);const[bugData,setBugData]=useState([]);const[sortedData,setSortedData]=useState(false);const socket=useRef(null);useEffect(()=>{socket.current=new WebSocket('ws://localhost:3000');socket.current.onopen=()=>setMessages(prev=>[...prev,'Connected to server']);socket.current.onmessage=event=>{try{let data=JSON.parse(event.data);if(data.type==='bugData'){data=JSON.parse(data.content);setBugData(data);// save all bug data\nlet index=0;const newDataList=data.map(item=>{index+=1;return{key:index,id:index,severity:item.severity,type:item.bug_type,qualifier:item.qualifier,location:'ln '+item.line+', cl '+item.column};});setTableData(newDataList);}else if(data.type==='download'){const fileName=window.prompt('Enter file name:','download.txt');// 弹出对话框获取文件名\nif(fileName){// 如果用户输入了文件名\nconst data=\"Hello, world!\";const blob=new Blob([data],{type:'text/plain'});const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=fileName;document.body.appendChild(a);a.click();document.body.removeChild(a);window.URL.revokeObjectURL(url);}}else if(data.type==='sortedData'){data=JSON.parse(data.content);let index=0;const newDataList=data.map(item=>{index+=1;return{key:index,id:index,severity:item.severity,type:item.bug_type,qualifier:item.qualifier,location:'ln '+item.line+', cl '+item.column};});setSortedData(newDataList);}setMessages(prev=>[...prev,data.message]);}catch(error){console.error('Error parsing message',error);setMessages(prev=>[...prev,'Error parsing message']);}};socket.current.onclose=()=>setMessages(prev=>[...prev,'Disconnected from server']);socket.current.onerror=error=>setMessages(prev=>[...prev,\"WebSocket error: \".concat(error.message)]);return()=>{if(socket.current){socket.current.close();}};},[]);const handleFileSelect=file=>{if(file&&file.type==='file'){setSelectedFile(file);setTableData([]);}};const bugDetection=newContent=>{console.log('sent');if(selectedFile){const updatedFile={...selectedFile,content:newContent};setSelectedFile(updatedFile);console.log(updatedFile.content);if(socket.current&&socket.current.readyState===WebSocket.OPEN){const messageContent=JSON.stringify({type:'bugDetection',content:updatedFile.content});socket.current.send(messageContent);}}};const patchGeneration=(bugLabel,bugID)=>{if(selectedFile){if(socket.current&&socket.current.readyState===WebSocket.OPEN){const messageContent=JSON.stringify({type:'patchGeneration',bugLabel:bugLabel,content:bugData[bugID-1]});socket.current.send(messageContent);}}};const getSortedData=()=>{if(selectedFile){if(socket.current&&socket.current.readyState===WebSocket.OPEN){const messageContent=JSON.stringify({type:'sortData'});socket.current.send(messageContent);}}};return/*#__PURE__*/_jsxs(Layout,{style:{minHeight:'100vh'},children:[/*#__PURE__*/_jsxs(Sider,{theme:\"light\",children:[/*#__PURE__*/_jsx(FileUploader,{onFileUpload:setFileData}),/*#__PURE__*/_jsx(FileTree,{fileData:fileData,onSelectFile:handleFileSelect})]}),/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsx(Content,{children:selectedFile?/*#__PURE__*/_jsx(FileEditorWithBugTable,{selectedFile:selectedFile,onBugDetection:bugDetection,tableData:tableData,onPatchGeneration:patchGeneration,getSortedData:getSortedData,sortedData:sortedData}):/*#__PURE__*/_jsx(\"div\",{style:{padding:'20px'},children:\"\\u9009\\u62E9\\u4E00\\u4E2A\\u6587\\u4EF6\\u4EE5\\u5F00\\u59CB\\u7F16\\u8F91\"})})})]});};export default App;","map":{"version":3,"names":["React","useState","useRef","useEffect","Layout","message","FileUploader","FileTree","FileEditorWithBugTable","jsx","_jsx","jsxs","_jsxs","Sider","Content","App","selectedFile","setSelectedFile","fileData","setFileData","messages","setMessages","tableData","setTableData","bugData","setBugData","sortedData","setSortedData","socket","current","WebSocket","onopen","prev","onmessage","event","data","JSON","parse","type","content","index","newDataList","map","item","key","id","severity","bug_type","qualifier","location","line","column","fileName","window","prompt","blob","Blob","url","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","error","console","onclose","onerror","concat","close","handleFileSelect","file","bugDetection","newContent","log","updatedFile","readyState","OPEN","messageContent","stringify","send","patchGeneration","bugLabel","bugID","getSortedData","style","minHeight","children","theme","onFileUpload","onSelectFile","onBugDetection","onPatchGeneration","padding"],"sources":["/home/njucs/bugDetection&Repair/code/src/App.js"],"sourcesContent":["// src/App.js\nimport React, { useState, useRef, useEffect } from 'react';\nimport { Layout , message } from 'antd';\nimport FileUploader from './FileUploader';\nimport FileTree from './FileTree';\nimport FileEditorWithBugTable from './FileEditorWithBugTable';\nconst { Sider, Content } = Layout;\n\nconst App = () => {\n  const [selectedFile, setSelectedFile] = useState(null);\n  const [fileData, setFileData] = useState([]);\n  const [messages, setMessages] = useState([]);\n  const [tableData, setTableData] = useState([]);\n  const [bugData, setBugData] = useState([]);\n  const [sortedData, setSortedData] = useState(false);\n  const socket = useRef(null);\n\n  useEffect(() => {\n    socket.current = new WebSocket('ws://localhost:3000');\n    socket.current.onopen = () => setMessages((prev) => [...prev, 'Connected to server']);\n    socket.current.onmessage = (event) => {\n      try {\n        let data = JSON.parse(event.data);\n        if(data.type === 'bugData'){\n          data = JSON.parse(data.content);\n          setBugData(data); // save all bug data\n          let index = 0;\n          const newDataList = data.map(item => {\n            index += 1;\n            return {\n              key: index,\n              id: index,\n              severity: item.severity,\n              type: item.bug_type,\n              qualifier: item.qualifier,\n              location: 'ln '+item.line+', cl '+item.column\n            };\n          });\n          setTableData(newDataList);\n        } else if(data.type === 'download') {\n          const fileName = window.prompt('Enter file name:', 'download.txt'); // 弹出对话框获取文件名\n          if (fileName) { // 如果用户输入了文件名\n            const data = \"Hello, world!\";\n            const blob = new Blob([data], { type: 'text/plain' });\n            const url = window.URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = fileName;\n            document.body.appendChild(a);\n            a.click();\n            document.body.removeChild(a);\n            window.URL.revokeObjectURL(url);\n          }\n        } else if(data.type === 'sortedData') {\n          data = JSON.parse(data.content);\n          let index = 0;\n          const newDataList = data.map(item => {\n            index += 1;\n            return {\n              key: index,\n              id: index,\n              severity: item.severity,\n              type: item.bug_type,\n              qualifier: item.qualifier,\n              location: 'ln '+item.line+', cl '+item.column\n            };\n          });\n          setSortedData(newDataList);\n        }\n        setMessages((prev) => [...prev, data.message]);\n      } catch (error) {\n        console.error('Error parsing message', error);\n        setMessages((prev) => [...prev, 'Error parsing message']);\n      }\n    };\n    socket.current.onclose = () => setMessages((prev) => [...prev, 'Disconnected from server']);\n    socket.current.onerror = (error) => setMessages((prev) => [...prev, `WebSocket error: ${error.message}`]);\n\n    return () => {\n      if (socket.current) {\n        socket.current.close();\n      }\n    };\n  }, []);\n\n  const handleFileSelect = (file) => {\n    if (file && file.type === 'file') {\n      setSelectedFile(file);\n      setTableData([]);\n    }\n  };\n\n  const bugDetection = (newContent) => {\n    console.log('sent');\n    if (selectedFile) {\n        const updatedFile = { ...selectedFile, content: newContent };\n        setSelectedFile(updatedFile);\n        console.log(updatedFile.content)\n        if (socket.current && socket.current.readyState === WebSocket.OPEN) {\n          const messageContent = JSON.stringify({\n            type: 'bugDetection',\n            content: updatedFile.content,\n          });\n          socket.current.send(messageContent);\n        }\n    }\n  };\n\n  const patchGeneration = (bugLabel, bugID) => {\n    if (selectedFile) {\n      if (socket.current && socket.current.readyState === WebSocket.OPEN) {\n        const messageContent = JSON.stringify({\n          type: 'patchGeneration',\n          bugLabel: bugLabel,\n          content: bugData[bugID-1],\n        });\n        socket.current.send(messageContent);\n      }\n    }\n  };\n\n  const getSortedData = () => {\n    if (selectedFile) {\n      if (socket.current && socket.current.readyState === WebSocket.OPEN) {\n        const messageContent = JSON.stringify({\n          type: 'sortData',\n        });\n        socket.current.send(messageContent);\n      }\n    }\n  };\n  return (\n    <Layout style={{ minHeight: '100vh' }}>\n      <Sider theme=\"light\">\n        <FileUploader onFileUpload={setFileData}/>\n        <FileTree fileData={fileData} onSelectFile={handleFileSelect} />\n      </Sider>\n      <Layout>\n        <Content>\n          {selectedFile ? (\n            <FileEditorWithBugTable\n              selectedFile={selectedFile}\n              onBugDetection={bugDetection}\n              tableData={tableData}\n              onPatchGeneration={patchGeneration}\n              getSortedData={getSortedData}\n              sortedData={sortedData}\n            />\n          ) : (\n            <div style={{ padding: '20px' }}>选择一个文件以开始编辑</div>\n          )}\n        </Content>\n      </Layout>\n    </Layout>\n  );\n};\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}